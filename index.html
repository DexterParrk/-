<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìš°ë¦¬ë“¤ì˜ ëª¨ì„ ë„ìš°ë¯¸</title>
    <style>
        :root {
            --primary: #FF6B6B;
            --secondary: #4D96FF;
            --bg: #f4f7f6;
            --text: #333;
            --white: #ffffff;
            --gray: #e0e0e0;
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* í—¤ë” */
        header {
            background: var(--white);
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            z-index: 10;
            font-weight: bold;
            font-size: 1.1rem;
        }

        /* ë©”ì¸ ì»¨í…ì¸  */
        main {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .page {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            padding: 20px;
            overflow-y: auto;
            display: none;
            flex-direction: column;
            align-items: center;
        }
        .page.active { display: flex; }

        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card {
            background: var(--white);
            border-radius: 20px;
            padding: 25px 20px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            text-align: center;
            margin-bottom: 20px;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            color: white;
            width: 100%;
            transition: 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn:active { transform: scale(0.98); }
        .btn-food { background: var(--primary); }
        .btn-game { background: var(--secondary); }
        
        /* ëª¨ë“œ ìŠ¤ìœ„ì¹˜ ë²„íŠ¼ */
        .mode-switch {
            display: flex;
            background: #eee;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 15px;
        }
        .mode-btn {
            flex: 1;
            padding: 10px;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #777;
            cursor: pointer;
            font-weight: bold;
        }
        .mode-btn.active {
            background: var(--white);
            color: var(--secondary);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* --- ìŒì‹ í˜ì´ì§€ ìŠ¤íƒ€ì¼ --- */
        .result-display {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--primary);
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            word-break: keep-all;
        }

        /* í•„í„° ì•„ì½”ë””ì–¸ */
        .filter-section {
            width: 100%;
            text-align: left;
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }
        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
        }
        .filter-content {
            display: none;
            padding: 10px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        .filter-content.open { display: block; }

        .category-group { margin-bottom: 15px; }
        .cat-title {
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            color: #555;
        }
        .cat-title input { margin-right: 8px; transform: scale(1.2); }
        
        .food-items {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding-left: 10px;
        }
        .food-checkbox { display: none; }
        .food-label {
            font-size: 0.8rem;
            padding: 6px 12px;
            background: #eee;
            border-radius: 20px;
            color: #777;
            cursor: pointer;
            transition: 0.2s;
        }
        .food-checkbox:checked + .food-label {
            background: #ffe0e0;
            color: var(--primary);
            font-weight: bold;
            border: 1px solid var(--primary);
        }

        /* --- ë£°ë › í˜ì´ì§€ ìŠ¤íƒ€ì¼ --- */
        canvas {
            width: 100%;
            max-width: 320px;
            height: auto;
            margin: 10px auto;
            border-radius: 50%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }
        .input-group { display: flex; gap: 8px; margin-bottom: 15px; }
        input[type="text"] {
            flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 10px; outline: none;
        }
        .tag-container {
            display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; margin-bottom: 15px;
        }
        .tag {
            background: #eef2ff; color: var(--secondary); padding: 5px 10px; border-radius: 15px; font-size: 0.85rem; cursor: pointer;
        }
        .arrow-down {
            width: 0; height: 0; 
            border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 20px solid #333;
            margin: 0 auto -10px auto; position: relative; z-index: 5;
        }

        /* ê²°ê³¼ ë°•ìŠ¤ (ë‹¹ì²¨ ì‹œ í‘œì‹œ) */
        .game-result-box {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #fff3cd;
            border: 2px solid #ffecb5;
            border-radius: 15px;
            animation: popIn 0.3s ease-out;
        }
        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .result-title { font-size: 1.5rem; font-weight: bold; color: #d63384; margin-bottom: 10px; }
        .result-desc { font-size: 1rem; color: #664d03; line-height: 1.5; }

        /* ë£° ì„¤ëª…ì„œ */
        .rule-book {
            margin-top: 15px;
            text-align: left;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            display: none;
            font-size: 0.9rem;
        }
        .rule-item { margin-bottom: 8px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .rule-item strong { color: var(--secondary); }

        /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
        nav {
            background: var(--white);
            display: flex;
            border-top: 1px solid #eee;
            height: 65px;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-item {
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: #aaa; font-size: 0.75rem; cursor: pointer; transition: 0.2s;
        }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .nav-item span { font-size: 1.4rem; margin-bottom: 4px; }
        .nav-item:nth-child(2).active { color: var(--secondary); }

    </style>
</head>
<body>

    <header>ğŸ‰ ìš°ë¦¬ë“¤ì˜ ëª¨ì„ ë„ìš°ë¯¸</header>

    <main>
        <!-- 1. ìŒì‹ ì¶”ì²œ í˜ì´ì§€ -->
        <section id="page-food" class="page active">
            <div class="card">
                <h2>ğŸ½ï¸ ì˜¤ëŠ˜ ë­ ë¨¹ì§€?</h2>
                <div class="result-display" id="foodDisplay">ë©”ë‰´ë¥¼ ê³¨ë¼ë³´ì„¸ìš”!</div>
                <button class="btn btn-food" id="foodBtn" onclick="spinFood()">ëœë¤ ì„ íƒ ì‹œì‘!</button>
                
                <!-- í•„í„° ì˜ì—­ -->
                <div class="filter-section">
                    <div class="filter-header" onclick="toggleFilter()">
                        <span>âš™ï¸ ë©”ë‰´ ì„¤ì • / ì œì™¸í•˜ê¸°</span>
                        <span id="filterArrow">â–¼</span>
                    </div>
                    <div class="filter-content" id="filterContent">
                        <div style="text-align:right; margin-bottom:10px;">
                            <button style="font-size:0.8rem; padding:5px 10px;" onclick="resetFilters()">ì „ì²´ ì„ íƒ</button>
                        </div>
                        <div id="foodListContainer"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. ë£°ë › ê²Œì„ í˜ì´ì§€ -->
        <section id="page-game" class="page">
            <div class="card">
                <h2>ğŸ¯ ë²Œì¹™/ë‚´ê¸° ë£°ë ›</h2>
                
                <!-- ëª¨ë“œ ìŠ¤ìœ„ì¹˜ -->
                <div class="mode-switch">
                    <button class="mode-btn active" id="modeMember" onclick="setGameMode('member')">ğŸ‘¥ ë©¤ë²„ ë½‘ê¸°</button>
                    <button class="mode-btn" id="modePenalty" onclick="setGameMode('penalty')">â˜ ï¸ ì§€ê° ë²Œì¹™</button>
                </div>

                <!-- ë©¤ë²„ ëª¨ë“œì¼ ë•Œë§Œ ë³´ì´ëŠ” ì…ë ¥ì°½ -->
                <div class="input-group" id="memberInputGroup">
                    <input type="text" id="newItem" placeholder="ì´ë¦„ ì¶”ê°€">
                    <button class="btn" style="width:auto; background:#666;" onclick="addMember()">ì¶”ê°€</button>
                </div>
                
                <!-- ë²Œì¹™ ëª¨ë“œì¼ ë•Œ ë³´ì´ëŠ” ì„¤ëª…ì„œ ë²„íŠ¼ -->
                <div id="penaltyRuleBtn" style="display:none; margin-bottom:10px;">
                    <button onclick="toggleRuleBook()" style="background:none; border:1px solid #ddd; padding:5px 10px; border-radius:15px; font-size:0.8rem; color:#666;">ğŸ“œ ë²Œì¹™ ì„¤ëª… ë³´ê¸°</button>
                    <div id="ruleBook" class="rule-book"></div>
                </div>

                <div class="tag-container" id="itemList"></div>

                <div class="arrow-down"></div>
                <canvas id="wheelCanvas" width="500" height="500"></canvas>
                
                <!-- ê²°ê³¼ ë°•ìŠ¤ -->
                <div id="gameResultBox" class="game-result-box">
                    <div class="result-title" id="resTitle">ë‹¹ì²¨!</div>
                    <div class="result-desc" id="resDesc">ë‚´ìš©ì´ ì—¬ê¸°ì— ë‚˜ì˜µë‹ˆë‹¤.</div>
                </div>

                <button class="btn btn-game" onclick="spinWheel()">ëŒë ¤ ëŒë ¤!</button>
            </div>
        </section>
    </main>

    <nav>
        <div class="nav-item active" onclick="switchTab('food')">
            <span>ğŸš</span>ë©”ë‰´ ì¶”ì²œ
        </div>
        <div class="nav-item" onclick="switchTab('game')">
            <span>ğŸ²</span>ë£°ë › ê²Œì„
        </div>
    </nav>

    <script>
        /* =========================================
           ë°ì´í„° ì •ì˜
           ========================================= */
        const foodData = {
            "ğŸ‡°ğŸ‡· í•œì‹": ["ê¹€ì¹˜ì°Œê°œ", "ëœì¥ì°Œê°œ", "ì œìœ¡ë³¶ìŒ", "ë¶ˆê³ ê¸°", "ì‚¼ê²¹ì‚´", "ë¹„ë¹”ë°¥", "ê°ìíƒ•", "ì¹¼êµ­ìˆ˜", "ìˆœëŒ€êµ­", "ì°œë‹­"],
            "ğŸ‡¨ğŸ‡³ ì¤‘ì‹": ["ì§œì¥ë©´", "ì§¬ë½•", "íƒ•ìˆ˜ìœ¡", "ë§ˆë¼íƒ•", "ë§ˆë¼ìƒ¹ê¶ˆ", "ê¿”ë°”ë¡œìš°", "ì–‘ê¼¬ì¹˜", "ë§ˆíŒŒë‘ë¶€", "ë³¶ìŒë°¥", "ìš°ìœ¡ë©´"],
            "ğŸ‡¯ğŸ‡µ ì¼ì‹": ["ì´ˆë°¥(ìŠ¤ì‹œ)", "ë¼ë©˜", "ëˆì¹´ì¸ ", "ê·œë™", "ê°€ì¸ ë™", "ì‚¬ì¼€ë™", "í…ë™", "ì˜¤ì½”ë…¸ë¯¸ì•¼í‚¤", "ì•¼í‚¤ì†Œë°”", "ìš°ë™"],
            "ğŸ‡ºğŸ‡¸ ì–‘ì‹": ["ìŠ¤í…Œì´í¬", "íŒŒìŠ¤íƒ€", "í”¼ì", "ë²„ê±°", "ë¦¬ì¡°ë˜", "ì¹˜í‚¨ìœ™", "ë°”ë¹„í ë¦½", "ìˆ˜í”„", "ìƒëŸ¬ë“œ", "ë¡œìŠ¤íŠ¸ ì¹˜í‚¨"],
            "ğŸ¢ ë¶„ì‹": ["ë–¡ë³¶ì´", "ìˆœëŒ€", "ê¹€ë°¥", "íŠ€ê¹€", "ë¼ë©´", "ì«„ë©´", "ë¹„ë¹”êµ­ìˆ˜", "ì¹˜ì¦ˆë¼ë³¶ì´", "ë§Œë‘", "ì”ì¹˜êµ­ìˆ˜"],
            "ğŸŒ® ë©•ì‹œì¹¸": ["íƒ€ì½”", "ë¶€ë¦¬ë˜", "í€˜ì‚¬ë””ì•¼", "ë‚˜ì´ˆ", "ì—”ì¹ ë¼ë‹¤", "íŒŒíˆíƒ€", "ì¹˜ë¯¸ì°½ê°€", "ë©•ì‹œì¹¸ ë¼ì´ìŠ¤", "ì‚´ì‚¬&ê³¼ì¹´ëª°ë¦¬", "í† ìŠ¤íƒ€ë‹¤"],
            "ğŸ‡®ğŸ‡¹ ì´íƒˆë¦¬ì•ˆ": ["ë§ˆë¥´ê²Œë¦¬íƒ€ í”¼ì", "ê¹Œë¥´ë³´ë‚˜ë¼", "ë¼ìëƒ", "ë´‰ê³¨ë ˆ", "í˜í˜ë¡ ì¹˜ë…¸", "ë‡¨ë¼", "ì¹´í”„ë ˆì œ", "ë¯¸ë„¤ìŠ¤íŠ¸ë¡œë„¤", "í‹°ë¼ë¯¸ìˆ˜", "ë¦¬ì¡°ë˜"],
            "ğŸ‡«ğŸ‡· í”„ë Œì¹˜": ["ìŠ¤í…Œì´í¬ í”„ë¦¬ì¸ ", "ì—ìŠ¤ì¹´ë¥´ê³ ", "ì¹´ìŠë ˆ", "ë¼ë”°ëšœì´", "í¬ë£¨ì•„ìƒ", "ë°”ê²ŒíŠ¸ ìƒŒë“œìœ„ì¹˜", "ì˜¤ë‹ˆì˜¨ ìˆ˜í”„", "í‚¤ì‰¬", "ë§ˆì¹´ë¡±", "í¬ë ˜ë¸Œë¥„ë ˆ"],
            "ğŸ‡¹ğŸ‡­ íƒœêµ­": ["íŒŸíƒ€ì´", "ë˜ ì–Œê¿", "ì¨ë•€", "ê·¸ë¦°ì»¤ë¦¬", "ë ˆë“œì»¤ë¦¬", "ì¹´ì˜¤ë§Œê°€ì´", "íŒŸì¹´íŒŒì˜¤", "ë¿ŒíŒŸíì»¤ë¦¬", "ì–Œìš´ì„¼", "ì¹´ì˜¤íŒŸ"],
            "ğŸ‡»ğŸ‡³ ë² íŠ¸ë‚¨": ["ìŒ€êµ­ìˆ˜", "ë¶„ì§œ", "ë°˜ë¯¸", "ë¶„ë³´í›„ì—", "ë¶„ì§œì¡°", "ì§œì¡°", "ê»ŒìŠ¹", "ì¹´í˜ì“°ì–´ë‹¤", "ë°˜ì„ì˜¤", "ì›”ë‚¨ìŒˆ"]
        };

        const defaultMembers = ["ë°•ê¸°íƒœ", "ê¹€ìœ¤ìˆ˜", "ê³ ìŠ¹ê·œ", "ì†¡ì£¼í—Œ", "ê¹€ì°¬ì˜", "ì´ìƒë²”", "ê¹€ì„±ê¶Œ", "ì´ìŠ¹í˜„", "ìœ ì§„í•˜", "ì´ì •ë¯¼", "ê¹€ì¥í˜„", "ì¡°ì¸ì¤€", "ì „ë³‘í˜„", "ê¹€íƒœí˜¸"];

        // ì§€ê° ë²Œì¹™ ë°ì´í„° (ì„¤ëª… ì¶”ê°€)
        const penaltyData = [
            { text: "ëª¨ì„ë¹„x1ë§Œ", weight: 1, desc: "í˜„ì¬ ìë¦¬ì— ìˆëŠ” ì‚¬ëŒ ìˆ˜ X 10,000ì› ì…ê¸ˆí•˜ê¸°! (í™•ë¥  ë‚®ìŒ)" },
            { text: "ì†Œì£¼ ì›ìƒ·", weight: 1, desc: "ê¹”ë”í•˜ê²Œ ì†Œì£¼ í•œ ì” ì›ìƒ·! (í™•ë¥  ë‚®ìŒ)" },
            { text: "ì…€ì¹´ ë™ì˜ìƒ", weight: 3, desc: "'ì§€ê°ì€ ë‚˜ìœ ê²ƒì…ë‹ˆë‹¤' ëŒ€ì‚¬ ì¹˜ë©´ì„œ ì…€ì¹´ ë™ì˜ìƒ ì´¬ì˜ í›„ ë‹¨í†¡ë°© ì—…ë¡œë“œ" },
            { text: "2ì°¨ ì˜ˆì•½", weight: 3, desc: "ì˜¤ëŠ˜ 2ì°¨ ì¥ì†Œ ë˜ëŠ” ë‹¤ìŒ ëª¨ì„ ì¥ì†Œ/ë©”ë‰´ ì˜ˆì•½í•˜ê³  ì¤€ë¹„í•˜ê¸°" },
            { text: "ê¸ˆì¹™ì–´ ì§€ì •", weight: 3, desc: "ì§€ê°ì 'í•˜ë£¨ ê¸ˆì¹™ì–´' ì§€ì • (ì˜ˆ: 'ì¡´ë‚˜' ì“°ë©´ ë²Œê¸ˆ 5000ì›)" },
            { text: "í”„ì‚¬ ë³€ê²½", weight: 3, desc: "ì¹œêµ¬ë“¤ì´ ì›í•˜ëŠ” ì—½ê¸° ì‚¬ì§„ìœ¼ë¡œ ì˜¤ëŠ˜ ìˆ ìë¦¬ ëë‚  ë•Œê¹Œì§€ í”„ì‚¬ ë³€ê²½" }
        ];

        /* =========================================
           1. ìŒì‹ ì¶”ì²œ ë¡œì§
           ========================================= */
        function initFoodFilters() {
            const container = document.getElementById('foodListContainer');
            let html = '';
            for (const [category, items] of Object.entries(foodData)) {
                html += `
                <div class="category-group">
                    <div class="cat-title">
                        <input type="checkbox" checked onchange="toggleCategory(this, '${category}')"> ${category}
                    </div>
                    <div class="food-items" id="cat-${category}">
                        ${items.map(item => `
                            <input type="checkbox" id="chk-${item}" class="food-checkbox" value="${item}" checked>
                            <label for="chk-${item}" class="food-label">${item}</label>
                        `).join('')}
                    </div>
                </div>`;
            }
            container.innerHTML = html;
        }

        function toggleCategory(source, categoryName) {
            const container = document.getElementById(`cat-${categoryName}`);
            const checkboxes = container.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = source.checked);
        }

        function toggleFilter() {
            const content = document.getElementById('filterContent');
            const arrow = document.getElementById('filterArrow');
            content.classList.toggle('open');
            arrow.innerText = content.classList.contains('open') ? 'â–²' : 'â–¼';
        }

        function resetFilters() {
            const checkboxes = document.querySelectorAll('#foodListContainer input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = true);
        }

        function getSelectedFoods() {
            const checkboxes = document.querySelectorAll('.food-checkbox:checked');
            const list = [];
            checkboxes.forEach(cb => list.push(cb.value));
            return list;
        }

        function spinFood() {
            const availableFoods = getSelectedFoods();
            const display = document.getElementById('foodDisplay');
            const btn = document.getElementById('foodBtn');

            if (availableFoods.length === 0) {
                alert("ì„ íƒëœ ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤! í•„í„°ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
                return;
            }
            if (btn.disabled) return;
            btn.disabled = true;
            btn.innerText = "ê³ ë¥´ëŠ” ì¤‘...";

            let counter = 0;
            const interval = setInterval(() => {
                const randomFood = availableFoods[Math.floor(Math.random() * availableFoods.length)];
                display.innerText = randomFood;
                counter += 50;
                if (counter > 1500) {
                    clearInterval(interval);
                    btn.disabled = false;
                    btn.innerText = "ë‹¤ì‹œ ê³ ë¥´ê¸°";
                    display.style.transform = "scale(1.2)";
                    setTimeout(() => display.style.transform = "scale(1)", 200);
                }
            }, 50);
        }

        /* =========================================
           2. ë£°ë › ê²Œì„ ë¡œì§
           ========================================= */
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        
        let currentMode = 'member'; 
        let currentItems = [...defaultMembers]; 
        let currentWeights = []; 
        let currentDescs = []; // ì„¤ëª… ì €ì¥ìš©

        let currentAngle = 0;
        let isSpinning = false;
        const colors = ["#FF6B6B", "#4D96FF", "#FFD93D", "#6BCB77", "#9D4EDD", "#FF9F43"];

        function setGameMode(mode) {
            if(isSpinning) return;
            currentMode = mode;
            
            document.getElementById('modeMember').className = mode === 'member' ? 'mode-btn active' : 'mode-btn';
            document.getElementById('modePenalty').className = mode === 'penalty' ? 'mode-btn active' : 'mode-btn';
            
            document.getElementById('memberInputGroup').style.display = mode === 'member' ? 'flex' : 'none';
            document.getElementById('penaltyRuleBtn').style.display = mode === 'penalty' ? 'block' : 'none';
            document.getElementById('gameResultBox').style.display = 'none'; // ê²°ê³¼ì°½ ìˆ¨ê¹€

            if (mode === 'member') {
                currentItems = [...defaultMembers];
                currentWeights = currentItems.map(() => 1);
                currentDescs = currentItems.map(() => "ì¶•í•˜í•©ë‹ˆë‹¤! (ë˜ëŠ” ì•ˆíƒ€ê¹ìŠµë‹ˆë‹¤!)");
            } else {
                currentItems = penaltyData.map(p => p.text);
                currentWeights = penaltyData.map(p => p.weight);
                currentDescs = penaltyData.map(p => p.desc);
                renderRuleBook();
            }
            drawWheel();
        }

        function renderRuleBook() {
            const book = document.getElementById('ruleBook');
            book.innerHTML = penaltyData.map(p => `
                <div class="rule-item">
                    <strong>${p.text}</strong><br>${p.desc}
                </div>
            `).join('');
        }

        function toggleRuleBook() {
            const book = document.getElementById('ruleBook');
            book.style.display = book.style.display === 'block' ? 'none' : 'block';
        }

        function drawWheel() {
            if (currentItems.length === 0) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                return;
            }

            const totalWeight = currentWeights.reduce((a, b) => a + b, 0);
            let startAngle = currentAngle;
            const radius = canvas.width / 2;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (let i = 0; i < currentItems.length; i++) {
                const sliceAngle = (currentWeights[i] / totalWeight) * 2 * Math.PI;
                const endAngle = startAngle + sliceAngle;

                ctx.beginPath();
                ctx.fillStyle = colors[i % colors.length];
                ctx.moveTo(radius, radius);
                ctx.arc(radius, radius, radius, startAngle, endAngle);
                ctx.lineTo(radius, radius);
                ctx.fill();

                ctx.save();
                ctx.translate(radius, radius);
                ctx.rotate(startAngle + sliceAngle / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "#fff";
                ctx.font = "bold 20px Arial";
                ctx.fillText(currentItems[i], radius - 20, 6);
                ctx.restore();

                startAngle = endAngle;
            }
            updateItemList();
        }

        function updateItemList() {
            const list = document.getElementById('itemList');
            list.innerHTML = '';
            
            currentItems.forEach((item, index) => {
                const tag = document.createElement('span');
                tag.className = 'tag';
                
                if (currentMode === 'member') {
                    tag.innerText = item + " âœ–";
                    tag.onclick = () => {
                        if(isSpinning) return;
                        currentItems.splice(index, 1);
                        currentWeights.splice(index, 1);
                        currentDescs.splice(index, 1);
                        drawWheel();
                    };
                } else {
                    const w = currentWeights[index];
                    const probText = w === 1 ? "(ë‚®ìŒ)" : "(ì¤‘ê°„)";
                    tag.innerText = item + " " + probText;
                    tag.style.cursor = "default";
                    tag.style.background = "#f0f0f0";
                    tag.style.color = "#666";
                }
                list.appendChild(tag);
            });
        }

        function addMember() {
            if (currentMode !== 'member') return;
            const input = document.getElementById('newItem');
            const val = input.value.trim();
            if(val) {
                currentItems.push(val);
                currentWeights.push(1);
                currentDescs.push("ì¶•í•˜í•©ë‹ˆë‹¤!");
                input.value = '';
                drawWheel();
            }
        }

        function spinWheel() {
            if (isSpinning || currentItems.length < 2) {
                if(currentItems.length < 2) alert("ìµœì†Œ 2ê°œ ì´ìƒì˜ í•­ëª©ì´ í•„ìš”í•©ë‹ˆë‹¤!");
                return;
            }
            
            // ê²°ê³¼ì°½ ìˆ¨ê¹€
            document.getElementById('gameResultBox').style.display = 'none';
            
            isSpinning = true;
            const spinTime = 3000;
            const spinAngle = Math.random() * 10 + 20; 
            let start = null;
            
            function animate(timestamp) {
                if (!start) start = timestamp;
                const progress = timestamp - start;
                if (progress < spinTime) {
                    const easeOut = 1 - Math.pow(1 - progress / spinTime, 3);
                    currentAngle += (spinAngle * (1 - easeOut)) * 0.1;
                    drawWheel();
                    requestAnimationFrame(animate);
                } else {
                    isSpinning = false;
                    showResult();
                }
            }
            requestAnimationFrame(animate);
        }

        function showResult() {
            // í™”ì‚´í‘œëŠ” ìƒë‹¨(270ë„, 1.5PI)ì— ìœ„ì¹˜
            // í˜„ì¬ ê°ë„ë¥¼ 0~2PIë¡œ ì •ê·œí™”
            const totalWeight = currentWeights.reduce((a, b) => a + b, 0);
            let normalizedAngle = currentAngle % (2 * Math.PI);
            
            // ìº”ë²„ìŠ¤ ê·¸ë¦¬ê¸° ì‹œì‘ì (0ë„)ì—ì„œ í™”ì‚´í‘œ ìœ„ì¹˜ê¹Œì§€ì˜ ê°ë„ ì°¨ì´ ê³„ì‚°
            // í™”ì‚´í‘œ ìœ„ì¹˜(1.5PI)ì—ì„œ í˜„ì¬ íšŒì „ê°ë„ë¥¼ ëºŒ (ì—­ë°©í–¥ ì¶”ì )
            let pointerAngle = (1.5 * Math.PI - normalizedAngle);
            if (pointerAngle < 0) pointerAngle += 2 * Math.PI;

            // ëˆ„ì  ê°ë„ë¡œ ì–´ë–¤ ì•„ì´í…œì¸ì§€ ì°¾ê¸°
            let accumulatedAngle = 0;
            let selectedIndex = 0;

            for (let i = 0; i < currentItems.length; i++) {
                const sliceAngle = (currentWeights[i] / totalWeight) * 2 * Math.PI;
                if (pointerAngle >= accumulatedAngle && pointerAngle < accumulatedAngle + sliceAngle) {
                    selectedIndex = i;
                    break;
                }
                accumulatedAngle += sliceAngle;
            }

            // ê²°ê³¼ í‘œì‹œ
            const box = document.getElementById('gameResultBox');
            const title = document.getElementById('resTitle');
            const desc = document.getElementById('resDesc');

            title.innerText = "ğŸ‰ " + currentItems[selectedIndex] + " ğŸ‰";
            desc.innerText = currentDescs[selectedIndex];
            box.style.display = "block";
        }

        /* =========================================
           ê³µí†µ: íƒ­ ì „í™˜ ë° ì´ˆê¸° ì‹¤í–‰
           ========================================= */
        function switchTab(tabName) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById('page-' + tabName).classList.add('active');
            const navIndex = tabName === 'food' ? 0 : 1;
            document.querySelectorAll('.nav-item')[navIndex].classList.add('active');
        }

        // ì•± ì‹œì‘ ì‹œ ì‹¤í–‰
        initFoodFilters();
        setGameMode('member'); 

    </script>
</body>
</html>
